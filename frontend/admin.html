<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SHAGEE MD - Admin Panel</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');

/* Reset & Base */
*, *::before, *::after { box-sizing: border-box; }
body { margin:0; padding:0; font-family:'Inter',sans-serif; background:#121212; color:#e0e0e0; overflow-x:hidden; position:relative; }
body::before {
  content:"";
  position:fixed; top:0; left:0; width:100%; height:100%;
  background: radial-gradient(circle at 50% 50%, rgba(0,255,234,0.1), transparent 40%),
              radial-gradient(circle at 25% 75%, rgba(0,255,234,0.05), transparent 40%),
              radial-gradient(circle at 75% 25%, rgba(0,255,234,0.05), transparent 40%);
  animation: rotate 30s linear infinite; z-index:-1;
}
@keyframes rotate {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}

/* Container */
.container { max-width:1100px; margin:0 auto; padding:2rem 1rem; }

/* Header */
header { display:flex; justify-content:space-between; align-items:center; padding:1.5rem 0; }
.logo { font-weight:900; font-size:1.8rem; color:#00ffea; letter-spacing:2px; user-select:none; text-transform:uppercase; text-shadow:0 0 8px #00ffea55; }
nav a { color:#a0a0a0; margin-left:2rem; font-weight:600; text-decoration:none; position:relative; transition:color 0.3s ease; }
nav a:hover, nav a.active { color:#00ffea; }
nav a::after { content:''; position:absolute; left:0; bottom:-6px; width:0; height:2px; background:#00ffea; transition:width 0.3s ease; }
nav a:hover::after, nav a.active::after { width:100%; }

/* Hero */
.hero { min-height:25vh; display:flex; flex-direction:column; justify-content:center; text-align:center; user-select:none; }
.hero h1 { font-size:2.5rem; font-weight:900; margin-bottom:1rem; letter-spacing:2px; text-shadow:0 0 10px #00ffea88; }
.hero p { font-weight:500; font-size:1.1rem; margin-bottom:2rem; color:#9e9e9e; }
.btn { padding:1rem 2rem; margin:0.5rem; border:2px solid #00ffea; background:transparent; color:#00ffea; font-weight:700; font-size:1rem; border-radius:35px; cursor:pointer; transition:all 0.3s ease; box-shadow:0 0 10px #00ffea55; display:inline-flex; align-items:center; gap:0.5rem; }
.btn:hover { background:#00ffea; color:#121212; box-shadow:0 0 30px #00ffea; }
.btn svg { stroke-width:2; stroke:currentColor; width:20px; height:20px; transition:transform 0.3s ease; }
.btn:hover svg { transform:translateX(6px); }

/* Dashboard Cards */
.cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:2rem; margin-bottom:2rem; }
.card { background:#1c1c1c; padding:1.5rem; border-radius:20px; box-shadow:0 0 15px #00ffea22; transition:transform 0.3s ease, box-shadow 0.3s ease; }
.card:hover { transform:translateY(-5px); box-shadow:0 0 35px #00ffeaaa; }
.card h2 { margin-top:0; font-size:1.3rem; margin-bottom:1rem; }
.card p { margin:5px 0; }

/* Table */
table { width:100%; border-collapse:collapse; background:#1c1c1c; border-radius:10px; overflow:hidden; }
th, td { padding:10px 12px; text-align:left; }
th { background:#2c2c2c; }
tr:nth-child(even){ background:#2a2a2a; }

/* Buttons */
button { border:none; padding:5px 10px; border-radius:6px; cursor:pointer; transition:0.2s; }
button:hover { opacity:0.85; }
.btn-danger { background:#f44336; color:white; }
.btn-action { background:#00ffea; color:rgb(0, 0, 0); }

/* Footer */
footer { text-align:center; padding:2rem 1rem; font-weight:500; color:#555; user-select:none; letter-spacing:1.1px; border-top:1px solid #222; }
footer .owner { color:#00ffea; font-weight:700; }
</style>
</head>
<body>

<header class="container">
  <div class="logo">SHAGEE Admin</div>
  <nav>
    <a href="#dashboard">Dashboard</a>
    <a href="#sessions">Active Sessions</a>
  </nav>
</header>

<section id="dashboard" class="container hero">
  <h1>Admin Dashboard</h1>
  <p>Monitor all active sessions, MongoDB, and bot health in real-time.</p>

  <div class="cards">
    <div class="card">
      <h2>MongoDB Status</h2>
      <p>Status: <span id="mongo-status">Loading...</span></p>
      <p>Connected: <span id="mongo-connected">Loading...</span></p>
      <p>Session Count: <span id="mongo-sessions">Loading...</span></p>
      <p>URI: <span id="mongo-uri">Loading...</span></p>
      <button class="btn btn-action" onclick="syncMongo()">Sync MongoDB</button>
    </div>
    <div class="card">
      <h2>Auto Session Manager</h2>
      <p>Status: <span id="auto-status">Loading...</span></p>
      <p>Active Sessions: <span id="active-sessions">Loading...</span></p>
      <p>Pending Saves: <span id="pending-saves">Loading...</span></p>
      <p>Features: <span id="auto-features">Loading...</span></p>
      <button class="btn btn-action" onclick="cleanupSessions()">Cleanup Inactive</button>
    </div>
  </div>
</section>

<section id="sessions" class="container">
  <h2>Active Sessions</h2>
  <table>
    <thead>
      <tr>
        <th>Number</th>
        <th>Health</th>
        <th>Uptime</th>
        <th>Last Backup</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="sessions-table">
      <tr><td colspan="6">Loading...</td></tr>
    </tbody>
  </table>
</section>

<footer>
  &copy; 2025 â€” DEVELOPED BY <br><span class="owner">SHAGEE-Coders Team</span>
</footer>

<script>
async function fetchMongo() {
  try {
    const res = await fetch('/api/mongodb-status');
    const data = await res.json();
    document.getElementById('mongo-status').textContent = data.mongodb.status;
    document.getElementById('mongo-connected').textContent = data.mongodb.connected ? 'Yes' : 'No';
    document.getElementById('mongo-connected').className = data.mongodb.connected ? 'status-connected' : 'status-disconnected';
    document.getElementById('mongo-sessions').textContent = data.mongodb.sessionCount;
    document.getElementById('mongo-uri').textContent = data.mongodb.uri;
  } catch(e) { console.error(e); }
}

async function fetchAuto() {
  try {
    const res = await fetch('/api/ping');
    const data = await res.json();
    document.getElementById('auto-status').textContent = data.status;
    document.getElementById('active-sessions').textContent = data.activeSessions;
    document.getElementById('pending-saves').textContent = data.pendingSaves;
    const features = Object.entries(data.autoFeatures).map(([k,v])=>`${k}: ${v}`).join(', ');
    document.getElementById('auto-features').textContent = features;
  } catch(e){ console.error(e); }
}

async function fetchSessions() {
  try {
    const res = await fetch('/api/active');
    const data = await res.json();
    const tbody = document.getElementById('sessions-table');
    tbody.innerHTML='';
    if(data.numbers.length===0){
      tbody.innerHTML='<tr><td colspan="6">No active sessions</td></tr>';
      return;
    }
    data.numbers.forEach(num=>{
      const session=data.health[num];
      const uptime=new Date(session.uptime).toISOString().substr(11,8);
      tbody.innerHTML+=`
      <tr>
        <td>${num}</td>
        <td>${session.health}</td>
        <td>${uptime}</td>
        <td>${session.lastBackup||'N/A'}</td>
        <td>${session.isActive?'Active':'Inactive'}</td>
        <td>
          <button onclick="deleteSession('${num}')">Delete</button>
          <button class="btn-danger" onclick="clearBadSession('${num}')">Clear Bad</button>
        </td>
      </tr>`;
    });
  } catch(e){ console.error(e); }
}

async function deleteSession(number){
  if(!confirm(`Delete session ${number}?`)) return;
  await fetch(`/api/session/${number}`,{method:'DELETE'});
  refreshAll();
}

async function clearBadSession(number){
  await fetch(`/api/clear-bad-session/${number}`);
  refreshAll();
}

async function syncMongo(){ await fetch('/api/sync-mongodb'); refreshAll(); }
async function cleanupSessions(){ await fetch('/api/cleanup'); refreshAll(); }

function refreshAll(){ fetchMongo(); fetchAuto(); fetchSessions(); }
window.onload=refreshAll;

// Smooth nav highlighting
const sections=document.querySelectorAll('section');
const navLinks=document.querySelectorAll('nav a');
window.addEventListener('scroll',()=>{
  let current='';
  sections.forEach(section=>{
    const sectionTop=section.offsetTop-50;
    if(pageYOffset>=sectionTop){ current=section.getAttribute('id'); }
  });
  navLinks.forEach(link=>{ link.classList.remove('active'); if(link.getAttribute('href')==='#'+current){ link.classList.add('active'); } });
});
</script>

</body>
</html>
